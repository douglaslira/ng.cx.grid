/**********************************************************
 * 
 * ng.cx.grid - v0.1.23
 * 
 * Release date : 2016-06-17 : 15:33
 * Author       : Jaime Beneytez - EF CTX 
 * License      : MIT 
 * 
 **********************************************************/



!function(a){"use strict";a.module("ng.cx.grid.CxCell",[]).factory("CxCell",["$compile","$rootScope","$timeout",function(b,c,d){function e(a,b,c){function d(){x=f(a,b,c)}function e(){return z}function k(){return x}function l(){return r(x,"width")}function m(){return r(x,"height")}function n(){return r(x,"top")}function o(){return r(x,"left")}function p(){return s(x,"top")}function q(){return s(x,"left")}function r(a,b){return w||(w=i(a)),w[b]}function s(a,b){return v||(v=j(a)),v[b]}var t,u,v,w,x,y=this,z=a;Object.defineProperty(this,"data",{get:e}),Object.defineProperty(this,"$element",{get:k}),Object.defineProperty(this,"width",{get:l}),Object.defineProperty(this,"height",{get:m}),Object.defineProperty(this,"relativeTop",{get:p}),Object.defineProperty(this,"relativeLeft",{get:q}),Object.defineProperty(this,"absoluteTop",{get:n}),Object.defineProperty(this,"absoluteLeft",{get:o}),this.resize=function(a,b){var c=a||(u?u.width:0),d=b||(t?t.height:0);g(x,c,d)},this.position=function(a,b){var c=a||u?u.relativeLeft:null,d=b||t?t.relativeTop:null;v=null,w=null,h(x,c,d)},this.positionByHeaders=function(a,b){u=b,t=a,y.position(),y.resize()},this.on=function(a,b){x.on(a,function(a){b.call(this,a,y)})},this.select=function(){x.hasClass("selected")?y.deSelect():x.addClass("selected")},this.deSelect=function(){x.removeClass("selected")},d()}function f(a,d,e){var f=c.$new(!0,e),g='<div class="cx-grid-cell"><div class="cx-grid-cell-renderer" ###directiveId###></div></div>';return g=g.replace("###directiveId###",d),f.dataProvider=a,b(g)(f)}function g(a,b,c){a.css("width",b+"px"),a.css("height",c+"px")}function h(b,c,d){a.isNumber(c)&&a.isNumber(d)&&b.css("transform","translate3d("+(c||0)+"px,"+(d||0)+"px, 0px )")}function i(a){return a[0].getBoundingClientRect()}function j(a){var b,c=i(a),d=a.parent();return b=d?i(d):null,{left:c.left-(b?b.left:0)+d[0].scrollLeft,top:c.top-(b?b.top:0)+d[0].scrollTop}}return e}]),a.module("ng.cx.grid.CxGrid",["ng.cx.grid.CxCell"]).factory("CxGrid",["$timeout","CxCell",function(a,b){function c(b,c,f,g,h,i,j,k,l,m,n){function o(){E(),J.onRowAdded(s),J.onColAdded(r),I=J.map(u,t,v),A(),B(),a(function(){C(),D(),F()})}function p(a,b){G(I.getAxisByHeader(b))}function q(a,b){G(I.getAxisByHeader(b))}function r(b,c,d){var e=t(c),f=d.map(v);I.addColAt(b,e,f),0===b?j.prepend(e.$element):I.getColHeaderAt(b-1).$element.after(e.$element),a(function(){I.mapColHeaders(z),I.mapCells(y),C()})}function s(b,c,d){var e=u(c),f=d.map(v);I.addRowAt(b,e,f),0===b?k.prepend(e.$element):I.getRowHeaderAt(b-1).$element.after(e.$element),a(function(){I.mapRowHeaders(z),I.mapCells(y),C()})}function t(a,b){var c=d(a,f,n);return c.on("click",p),c}function u(a,b){var c=d(a,g,n);return c.on("click",q),c}function v(a,b,e){return d(a,c,n)}function w(a,b){j.append(a.$element)}function x(a,b){k.append(a.$element)}function y(a,b,c){a&&(a.positionByHeaders(I.getRowHeaderAt(b),I.getColHeaderAt(c)),l.append(a.$element))}function z(a){a.position()}function A(){I.map(x,w)}function B(){H=d(void 0,h,n),m.append(H.$element)}function C(){var a=e(I.colHeaders,"height"),b=e(I.rowHeaders,"width");H.resize(b,a)}function D(){I.mapCells(y)}function E(){i.css("opacity",0)}function F(){i.css("opacity",1),console.timeEnd("grid")}function G(a){function b(a){a&&a.select()}function c(a){a&&a.deSelect()}function d(a){return K[0]===a[0]}K.map(c),d(a)||(a.map(b),K=a)}var H,I,J=b,K=[];Object.defineProperty(this,"width",{get:function(){return I.width}}),Object.defineProperty(this,"height",{get:function(){return I.height}}),o()}function d(a,c,d){return new b(a,c,d)}function e(a,b){var c=a.map(function(a,c){return a[b]});return Math.max.apply(null,c)}return c}]),a.module("ng.cx.grid.CxGridMatrix",["ng.cx.grid.CxMatrix"]).factory("CxGridMatrix",["CxMatrix",function(a){function b(c,d,e){function f(b,c,d){B=Array.isArray(b)?b.concat():[],C=Array.isArray(c)?c.concat():[],D=d instanceof a?d.getCopy():new a(d)}function g(){return D.width}function h(){return D.height}function i(){return B}function j(){return C}function k(){return D}function l(a,b){return D.getCellAt(a,b)}function m(a){return C[a]}function n(a){return B[a]}function o(a){return[B[a]].concat(D.getRowAt(a))}function p(a){return[C[a]].concat(D.getColAt(a))}function q(a){var b=B.indexOf(a),c=C.indexOf(a);if(b>-1)return o(b);if(c>-1)return p(c);throw new Error("CxGridMatrix.getAxisByHeader error: the header provided is not present on any of the headers lists")}function r(a,b,c){B.splice(a,0,b),D.addRowAt(a,c),A("onRowAdded",a,b,c)}function s(a,b,c){C.splice(a,0,b),D.addColAt(a,c),A("onColAdded",a,b,c)}function t(){return new b(B,C,D)}function u(a,c,d){var e="function"==typeof a?v(a):B,f="function"==typeof c?w(c):C,g="function"==typeof d?x(d):D;return new b(e,f,g)}function v(a){return B.map(a)}function w(a){return C.map(a)}function x(a){return D.map(a)}function y(a){E.onRowAdded.push(a)}function z(a){E.onColAdded.push(a)}function A(a,b,c,d){E[a].map(function(a){a.call(this,b,c,d)})}var B,C,D,E={onRowAdded:[],onColAdded:[]};Object.defineProperty(this,"width",{get:g}),Object.defineProperty(this,"height",{get:h}),Object.defineProperty(this,"rowHeaders",{get:i}),Object.defineProperty(this,"colHeaders",{get:j}),Object.defineProperty(this,"cells",{get:k}),this.getCellAt=l,this.getColHeaderAt=m,this.getRowHeaderAt=n,this.getColAt=p,this.getRowAt=o,this.getAxisByHeader=q,this.addColAt=s,this.addRowAt=r,this.getCopy=t,this.map=u,this.mapColHeaders=w,this.mapRowHeaders=v,this.mapCells=x,this.onColAdded=z,this.onRowAdded=y,f(c,d,e)}return b}]),a.module("ng.cx.grid.CxMatrix",[]).factory("CxMatrix",[function(){function a(b){function c(){Array.isArray(b)&&Array.isArray(b[0])&&(q=b,m())}function d(){return o}function e(){return p}function f(a,b){return q[a][b]}function g(a){for(var b=[],c=0;c<n.height;c++)b.push(q[c][a]);return b}function h(a){return q[a]}function i(a,b){for(var c=0;c<n.height;c++)q[c].splice(a,0,b[c]);p++}function j(a,b){q.splice(a,0,b),o++}function k(){return new a(q)}function l(b){var c=q.map(function(a,c){return a.map(function(a,d){return b.call(this,a,c,d,n)})});return new a(c)}function m(){p=q[0].length,o=q.length}var n=this,o=0,p=0,q=[[]];Object.defineProperty(this,"height",{get:d}),Object.defineProperty(this,"width",{get:e}),this.getCellAt=f,this.getColAt=g,this.getRowAt=h,this.addRowAt=j,this.addColAt=i,this.getCopy=k,this.map=l,c()}return a}]),a.module("ng.cx.grid.cxGridService",[]).service("cxGridService",[function(){function a(a){g=a}function b(){g=void 0}function c(a){g.highlightRow(a)}function d(a){g.highlightColumn(a)}function e(a,b,c){g.addRowAt(a,b,c)}function f(a,b,c){g.addColAt(a,b,c)}var g;this.addGrid=a,this.cleanCurrentGrid=b,this.highlightRow=c,this.highlightColumn=d,this.addRowAt=e,this.addColAt=f}]),a.module("ng.cx.grid.cxScroll",[]).directive("cxScroll",[function(){return{restrict:"AE",bindToController:{ioScrollId:"@",ioScrollRestrictToAxis:"@?",ioSnapCoords:"=?",ioScrollOnScroll:"=?"},controller:"cxScrollController as cxScrollController"}}]).controller("cxScrollController",["$element","$attrs","cxScrollService",function(a,b,c){var d,e,f="x"===this.ioScrollRestrictToAxis,g="y"===this.ioScrollRestrictToAxis,h=this.ioSnapCoords,i=this.ioScrollOnScroll,j=b.cxBindScroll;f&&(d=!1,e=!0),g&&(d=!0,e=!1),c.bind(j,a,d,e,h,i)}]).service("cxScrollService",["$timeout",function(b){function c(a,b,c,d,f,h){g[a]||(g[a]=new e),g[a].addElement(b,c,d,f,h)}function d(a){return g[a]}function e(){function c(b,c,e,f,g){var h=b[0];k=b,h.cxScrollService={scrollTop:a.isDefined(c)?c:!0,scrollLeft:a.isDefined(e)?e:!0},f&&(m=f,l=h),g&&k.on("scroll",g),n.push(h),d()}function d(){k.on("scroll",e)}function e(a){i(),g(a.target)}function g(a){for(var b=0;b<n.length;b++)h(n[b],a)}function h(a,b){a.cxScrollService.scrollTop&&b.cxScrollService.scrollTop&&(a.scrollTop=b.scrollTop),a.cxScrollService.scrollLeft&&b.cxScrollService.scrollLeft&&(a.scrollLeft=b.scrollLeft)}function i(){b.cancel(f),f=b(j,100)}function j(){}var k,l,m,n=[];this.addElement=c,Object.defineProperty(this,"$element",{get:function(){return k}})}var f,g={};this.bind=c,this.getScrollBindingById=d}]),a.module("ng.cx.grid.grid",["ng.cx.grid.cxScroll","ng.cx.grid.CxGrid","ng.cx.grid.cxGridService"]).directive("cxGrid",[function(){return{restrict:"AE",replace:"element",templateUrl:"src/grid/ng.cx.grid.html",controller:"cxGridController as gridController",scope:{},bindToController:{ioDataProvider:"=?",ioCellRenderer:"@?",ioRowHeaderRenderer:"@?",ioColumnHeaderRenderer:"@?",ioCornerRenderer:"@?"}}}]).controller("cxGridController",["$scope","$element","CxGrid","cxGridService",function(b,c,d,e){function f(a){var b=a.target.scrollTop,c=a.target.scrollLeft;b>0?m.addClass("is-scrolling-y"):m.removeClass("is-scrolling-y"),c>0?m.addClass("is-scrolling-x"):m.removeClass("is-scrolling-x")}function g(b){return a.element(c[0].querySelector(b))}var h,i,j,k,l,m=c;this.scrollHandler=f,i=g(".cx-grid-rh-container"),j=g(".cx-grid-ch-container"),k=g(".cx-grid-cells-container"),l=g(".cx-grid-corner-container"),h=new d(this.ioDataProvider,this.ioCellRenderer,this.ioColumnHeaderRenderer,this.ioRowHeaderRenderer,this.ioCornerRenderer,c,j,i,k,l,b),window.cxGrid=h,e.addGrid(h)}]),a.module("ng.cx.grid",["ng.cx.grid.grid"]),a.module("ng.cx.grid").run(["$templateCache",function(a){a.put("src/grid/ng.cx.grid.html","<div class=ng-cx-grid><div class=cx-grid-header><div class=cx-grid-corner-container></div><div class=cx-grid-ch-container cx-scroll=gridScroll io-scroll-restrict-to-axis=x></div></div><div class=cx-grid-body><div class=cx-grid-rh-container cx-scroll=gridScroll io-scroll-restrict-to-axis=y></div><div class=cx-grid-cells-container cx-scroll=gridScroll io-scroll-on-scroll=gridController.scrollHandler></div></div></div>")}])}(angular);