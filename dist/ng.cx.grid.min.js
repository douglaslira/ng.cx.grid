/**********************************************************
 * 
 * ng.cx.grid - v0.1.17
 * 
 * Release date : 2016-06-14 : 15:08
 * Author       : Jaime Beneytez - EF CTX 
 * License      : MIT 
 * 
 **********************************************************/



!function(a){"use strict";a.module("ng.cx.grid.CxCell",[]).factory("CxCell",["$compile","$rootScope","$timeout",function(b,c,d){function e(b,c,d,e,i,l){function m(){return F.hasClass(L)}function n(a){a.$element.addClass(L)}function o(a){a.$element.removeClass(L)}function p(){return G.isHighlighted?G.unHighlight():G.highlight()}function q(a){I.push(a)}function r(){return H}function s(){return F}function t(){return B(F,"width")}function u(){return B(F,"height")}function v(){return B(F,"top")}function w(){return B(F,"left")}function x(){return C(F,"top")}function y(){return C(F,"left")}function z(){return a.isArray(M)?M.indexOf(G):void 0}function A(){return I}function B(a,b){return E||(E=j(a)),E[b]}function C(a,b){return D||(D=k(a)),D[b]}var D,E,F,G=this,H=b,I=[],J=e,K=i,L="highlight",M=l;Object.defineProperty(this,"data",{get:r}),Object.defineProperty(this,"$element",{get:s}),Object.defineProperty(this,"width",{get:t}),Object.defineProperty(this,"height",{get:u}),Object.defineProperty(this,"relativeTop",{get:x}),Object.defineProperty(this,"relativeLeft",{get:y}),Object.defineProperty(this,"absoluteTop",{get:v}),Object.defineProperty(this,"absoluteLeft",{get:w}),Object.defineProperty(this,"index",{get:z}),Object.defineProperty(this,"children",{get:A}),Object.defineProperty(this,"isHighlighted",{get:m}),this.rowHeader=e,this.colHeader=i,this.addChild=q,this.highlight=function(){n(G),I.map(n)},this.unHighlight=function(){o(G),I.map(o)},this.resize=function(a,b){var c=a||K.width,d=b||J.height;g(F,c,d)},this.position=function(a,b){var c=a||K?K.relativeLeft:null,d=b||J?J.relativeTop:null;D=null,E=null,h(F,c,d)},F=f(b,c,d,J,K),F.on("click",p),J&&J.addChild(G),K&&K.addChild(G)}function f(a,b,c,d,e){var f=i(a,b,c);return d&&e&&(g(f,e.width,d.height),h(f,e.relativeLeft,d.relativeTop)),f}function g(a,b,c){a.css("width",b+"px"),a.css("height",c+"px")}function h(b,c,d){a.isNumber(c)&&a.isNumber(d)&&b.css("transform","translate3d("+(c||0)+"px,"+(d||0)+"px, 0px )")}function i(a,d,e){var f=c.$new(!0,e),g='<div class="cx-grid-cell"><div class="cx-grid-cell-renderer" ###directiveId###></div></div>';return g=g.replace("###directiveId###",d),f.dataProvider=a,b(g)(f)}function j(a){return a[0].getBoundingClientRect()}function k(a){var b,c=j(a),d=a.parent();return b=d?j(d):null,{left:c.left-(b?b.left:0)+d[0].scrollLeft,top:c.top-(b?b.top:0)+d[0].scrollTop}}return e}]),a.module("ng.cx.grid.CxGrid",["ng.cx.grid.CxCell"]).factory("CxGrid",["$timeout","CxCell",function(b,c){function d(c,d,g,h,i,j,k,l,m,n,o){function p(a,b){return I[a][b]}function q(a,c,e){B(a,c,g,H,k),b(function(){t(a,e,d,m)})}function r(a,c,e){B(a,c,h,G,l),b(function(){s(a,e,d,m)})}function s(a,c,d,f){for(var g,h=[],i=0;i<F.width;i++)g=e(c[i],d,o,G[a],H[i]),h[i]=g,g.position(),f.append(g.$element);I.splice(a,0,h),b(u(a+1,0))}function t(a,c,d,f){for(var g,h=0;h<F.height;h++)g=e(c[h],d,o,G[h],H[a]),I[h].splice(a,0,g),g.position(),f.append(g.$element);b(u(0,a+1))}function u(a,b){a=a||0,b=b||0;for(var c=0;c<F.height;c++){G[c].position();for(var d=0;d<F.width;d++)H[d].position(),I[c][d].position(),I[c][d].resize()}}function v(){w(),y(),b(C),b(D),b(x)}function w(){j.css("opacity",0)}function x(){j.css("opacity",1),console.timeEnd("grid")}function y(){c.colHeaders.map(z),c.rowHeaders.map(A)}function z(a){B(null,a,g,H,k)}function A(a){B(null,a,h,G,l)}function B(b,c,d,f,g){var h=e(c,d,o,null,null,f);return b=a.isNumber(b)?b:f.length,f.splice(b,0,h),0===b?g.prepend(h.$element):b>=f.length-1?g.append(h.$element):(f[b-1].$element.after(h.$element),f.map(function(a){a.position()})),h}function C(){var a=f(G,"width"),b=f(H,"height"),c=e(void 0,i,o);c.resize(a,b),n.append(c.$element)}function D(){for(var a=0;a<G.length;a++){I[a]=[];for(var b=0;b<H.length;b++)I[a][b]=E(a,b)}}function E(a,b){var f=c.cells[a][b],g=e(f,d,o,G[a],H[b]);return m.append(g.$element),g}var F=this,G=[],H=[],I=[[]];Object.defineProperty(this,"width",{get:function(){return H.length}}),Object.defineProperty(this,"height",{get:function(){return G.length}}),this.addColumnAt=q,this.addRowAt=r,this.getCell=p,v()}function e(a,b,d,e,f,g){return new c(a,b,d,e,f,g)}function f(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)}return d}]),function(a){function b(a,b,c){function d(a,b){return p[a][b]}function e(a){return o[a]}function f(a){return n[a]}function g(a){var b=[];return b.push(n[a]),b.concat(p[a])}function h(a){var b=[];b.push(o[a]);for(var c=0;c<o.length;c++)b.push(p[c][a]);return b}function i(a,b,c){o.splice(a,0,b),console.log("_rowHeaders",o);for(var d=0;d<m.width;d++)console.log("col",d),console.log("cells[col]",c[d]),p[d].splice(a,0,c[d])}function j(a,b,d){n.splice(a,0,b),p.splice(a,0,c)}function k(){return n.length}function l(){return o.length}var m=this,n=a||[],o=b||[],p=c||[];Object.defineProperty(this,"width",{get:k}),Object.defineProperty(this,"height",{get:l}),this.getCellAt=d,this.getRowHeaderAt=e,this.getColHeaderAt=f,this.getColAt=g,this.getRowAt=h,this.addRowAt=i,this.addColAt=j}a.module("ng.cx.grid.CxMatrix",[]).factory("CxMatrix",[function(){return b}])}(a),a.module("ng.cx.grid.cxGridService",[]).service("cxGridService",[function(){function a(a){g=a}function b(){g=void 0}function c(a){g.highlightRow(a)}function d(a){g.highlightColumn(a)}function e(a,b,c){g.addRowAt(a,b,c)}function f(a,b,c){g.addColumnAt(a,b,c)}var g;this.addGrid=a,this.cleanCurrentGrid=b,this.highlightRow=c,this.highlightColumn=d,this.addRowAt=e,this.addColumnAt=f}]),a.module("ng.cx.grid.cxScroll",[]).directive("cxScroll",[function(){return{restrict:"AE",bindToController:{ioScrollId:"@",ioScrollRestrictToAxis:"@?",ioSnapCoords:"=?",ioScrollOnScroll:"=?"},controller:"cxScrollController as cxScrollController"}}]).controller("cxScrollController",["$element","$attrs","cxScrollService",function(a,b,c){var d,e,f="x"===this.ioScrollRestrictToAxis,g="y"===this.ioScrollRestrictToAxis,h=this.ioSnapCoords,i=this.ioScrollOnScroll,j=b.cxBindScroll;f&&(d=!1,e=!0),g&&(d=!0,e=!1),c.bind(j,a,d,e,h,i)}]).service("cxScrollService",["$timeout",function(b){function c(a,b,c,d,f,h){g[a]||(g[a]=new e),g[a].addElement(b,c,d,f,h)}function d(a){return g[a]}function e(){function c(b,c,e,f,g){var h=b[0];k=b,h.cxScrollService={scrollTop:a.isDefined(c)?c:!0,scrollLeft:a.isDefined(e)?e:!0},f&&(m=f,l=h),g&&k.on("scroll",g),n.push(h),d()}function d(){k.on("scroll",e)}function e(a){i(),g(a.target)}function g(a){for(var b=0;b<n.length;b++)h(n[b],a)}function h(a,b){a.cxScrollService.scrollTop&&b.cxScrollService.scrollTop&&(a.scrollTop=b.scrollTop),a.cxScrollService.scrollLeft&&b.cxScrollService.scrollLeft&&(a.scrollLeft=b.scrollLeft)}function i(){b.cancel(f),f=b(j,100)}function j(){}var k,l,m,n=[];this.addElement=c,Object.defineProperty(this,"$element",{get:function(){return k}})}var f,g={};this.bind=c,this.getScrollBindingById=d}]),a.module("ng.cx.grid.grid",["ng.cx.grid.cxScroll","ng.cx.grid.CxGrid","ng.cx.grid.cxGridService"]).directive("cxGrid",[function(){return{restrict:"AE",replace:"element",templateUrl:"src/grid/ng.cx.grid.html",controller:"cxGridController as gridController",scope:{},bindToController:{ioDataProvider:"=?",ioCellRenderer:"@?",ioRowHeaderRenderer:"@?",ioColumnHeaderRenderer:"@?",ioCornerRenderer:"@?"}}}]).controller("cxGridController",["$scope","$element","CxGrid","cxGridService",function(b,c,d,e){function f(a){var b=a.target.scrollTop,c=a.target.scrollLeft;b>0?m.addClass("is-scrolling-y"):m.removeClass("is-scrolling-y"),c>0?m.addClass("is-scrolling-x"):m.removeClass("is-scrolling-x")}function g(b){return a.element(c[0].querySelector(b))}var h,i,j,k,l,m=c;this.scrollHandler=f,i=g(".cx-grid-rh-container"),j=g(".cx-grid-ch-container"),k=g(".cx-grid-cells-container"),l=g(".cx-grid-corner-container"),h=new d(this.ioDataProvider,this.ioCellRenderer,this.ioColumnHeaderRenderer,this.ioRowHeaderRenderer,this.ioCornerRenderer,c,j,i,k,l,b),window.cxGrid=h,e.addGrid(h)}]),a.module("ng.cx.grid",["ng.cx.grid.grid"]),function(a){function b(){return c}function c(a,b){function c(a,b,c){i(a,b),j(a,c)}function g(a,b,c){k(a,b),l(a,c)}function h(){for(var c=0;b>c;c++){n.push(f(c,g,b)),o.push([]);for(var g=0;a>g;g++)0===c&&m.push(e(c,g,a)),o[c].push(d(c,g))}}function i(a,b){n.splice(a,0,b)}function j(a,b){o.splice(a,0,b)}function k(a,b){m.splice(a,0,b)}function l(a,b){for(var c=0;c<o.length;c++)o[c].splice(a,0,b[c])}var m=[],n=[],o=[];this.addRowAt=c,this.addColumnAt=g,Object.defineProperty(this,"rowHeaders",{get:function(){return n}}),Object.defineProperty(this,"colHeaders",{get:function(){return m}}),Object.defineProperty(this,"cells",{get:function(){return o}}),h()}function d(a,b){return{title:"Closed answer",label:a+"-"+b,score:1!==b?Math.floor(10*Math.random())%5:void 0}}function e(a,b,c){return{label:b+1,count:b+1,total:c,score:1!==b?Math.floor(10*Math.random())%5:void 0}}function f(a,b,c){return{label:a+1,count:b+1,total:c,score:1!==b?Math.floor(10*Math.random())%5:void 0}}a.module("gridData",[]).factory("GridData",[b])}(a),a.module("ng.cx.grid").run(["$templateCache",function(a){a.put("src/grid/ng.cx.grid.html","<div class=ng-cx-grid><div class=cx-grid-header><div class=cx-grid-corner-container></div><div class=cx-grid-ch-container cx-scroll=gridScroll io-scroll-restrict-to-axis=x></div></div><div class=cx-grid-body><div class=cx-grid-rh-container cx-scroll=gridScroll io-scroll-restrict-to-axis=y></div><div class=cx-grid-cells-container cx-scroll=gridScroll io-scroll-on-scroll=gridController.scrollHandler></div></div></div>")}])}(angular);