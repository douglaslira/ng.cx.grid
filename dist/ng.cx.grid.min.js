/**********************************************************
 * 
 * ng.cx.grid - v0.0.4
 * 
 * Release date : 2016-04-18 : 15:39
 * Author       : Jaime Beneytez - EF CTX 
 * License      : MIT 
 * 
 **********************************************************/



!function(a){"use strict";a.module("ng.cx.grid.CxCell",[]).factory("CxCell",["$compile","$rootScope","$timeout",function(a,b,c){function d(a,b,c){function d(a){switch(a){case"on":t.addClass(v);break;case"off":t.removeClass(v);break;default:t.toggleClass(v)}}function f(){return u}function g(){return t}function h(){return p(t,"width")}function i(){return p(t,"height")}function l(){return p(t,"top")}function m(){return p(t,"left")}function n(){return q(t,"top")}function o(){return q(t,"left")}function p(a,b){return s||(s=j(a)),s[b]}function q(a,b){return r||(r=k(a)),r[b]}var r,s,t,u=a,v="highlight";Object.defineProperty(this,"data",{get:f}),Object.defineProperty(this,"$element",{get:g}),Object.defineProperty(this,"width",{get:h}),Object.defineProperty(this,"height",{get:i}),Object.defineProperty(this,"relativeTop",{get:n}),Object.defineProperty(this,"relativeLeft",{get:o}),Object.defineProperty(this,"absoluteTop",{get:l}),Object.defineProperty(this,"absoluteLeft",{get:m}),this.switchHighlighting=d,t=e(a,b,c)}function e(a,b,c){var d,e;return e='<div class="cell"><div class="cell-renderer" ###directiveId###></div></div>',e=e.replace("###directiveId###",b),d=i(a,e),c&&f(d,c),d}function f(a,b){b.measure&&g(a,b.measure),b.position&&h(a,b.position)}function g(a,b){a.css("width",b.width+"px"),a.css("height",b.height+"px")}function h(a,b){a.css("transform","translate3d("+(b.x||0)+"px,"+(b.y||0)+"px, 0px )")}function i(c,d){var e=b.$new(!0);return e.dataProvider=c,a(d)(e)}function j(a){return a[0].getBoundingClientRect()}function k(a){var b,c=j(a),d=a.parent();return b=d?j(d):null,{left:c.left-(b?b.left:0),top:c.top-(b?b.top:0)}}return d}]),a.module("ng.cx.grid.CxGrid",["ng.cx.grid.CxCell"]).factory("CxGrid",["$timeout","CxCell",function(a,b){function c(b,c,g,h,i,j,k,l,m,n,o,p){function q(a,b,c){void 0!==H.x&&H.x.switchHighlight("off"),void 0!==H.y&&H.y.switchHighlight("off"),H[b]="x"===b?D(a):C(a),void 0!==H.x&&H.x.switchHighlight("on"),void 0!==H.y&&H.y.switchHighlight("on")}function r(a){q(a,"x","on")}function s(a){q(a,"y","on")}function t(){u(),w(),a(z),a(A),a(v)}function u(){l.css("opacity",0)}function v(){l.css("opacity",1),console.timeEnd("render")}function w(){F=c.map(x),E=g.map(y)}function x(a){var b=d(a,i);return m.append(b.$element),b}function y(a){var b=d(a,j);return n.append(b.$element),b}function z(){var a={measure:{width:e(E,"width"),height:e(F,"height")}},b=d(void 0,k,a);p.append(b.$element)}function A(){var a,b,c=F.length,d=E.length;for(a=0;d>a;a++)for(G[a]=[],b=0;c>b;b++)G[a][b]=B(a,b)}function B(a,c){var e,f=b[a][c],g=F[c],i=E[a],j={measure:{width:g.width,height:i.height},position:{x:g.relativeLeft,y:i.relativeTop}};return e=d(f,h,j),o.append(e.$element),e}function C(a){for(var b=[F[a]],c=0;c<G.length;c++)b.push(G[c][a]);return new f(a,b)}function D(a){return new f(a,[E[a]].concat(G[a]))}console.time("render");var E=[],F=[],G=[[]],H={x:void 0,y:void 0};this.highlightRow=r,this.highlightColumn=s,t()}function d(a,c,d){return new b(a,c,d)}function e(a,b){var c=a.map(function(a){return console.log("row Header cell",a.width,a.height),a[b]});return Math.max.apply(null,c)}function f(a,b){function c(a){b.map(function(b){b.switchHighlighting(a)})}function d(a){return e.index===a.index}var e=this;Object.defineProperty(this,"index",{get:function(){return a}}),this.switchHighlight=c,this.isEqual=d}return c}]),a.module("ng.cx.grid.cxScroll",[]).directive("cxScroll",[function(){return{restrict:"AE",bindToController:{ioScrollId:"@",ioScrollRestrictToAxis:"@?",ioSnapCoords:"=?"},controller:"cxScrollController as cxScrollController"}}]).controller("cxScrollController",["$element","$attrs","cxScrollService",function(a,b,c){var d,e,f="x"===this.ioScrollRestrictToAxis,g="y"===this.ioScrollRestrictToAxis,h=this.ioSnapCoords,i=b.cxBindScroll;f&&(d=!1,e=!0),g&&(d=!0,e=!1),c.bind(i,a,d,e,h)}]).service("cxScrollService",["$timeout",function(b){function c(a,b,c,e,g){f[a]||(f[a]=new d),f[a].addElement(b,c,e,g)}function d(){function c(b,c,e,f){var g=b[0];k=b,g.cxScrollService={scrollTop:a.isDefined(c)?c:!0,scrollLeft:a.isDefined(e)?e:!0},f&&(m=f,l=g),n.push(g),d()}function d(){k.on("scroll",f)}function f(a){i(),g(a.target)}function g(a){for(var b=0;b<n.length;b++)h(n[b],a)}function h(a,b){a.cxScrollService.scrollTop&&b.cxScrollService.scrollTop&&(a.scrollTop=b.scrollTop),a.cxScrollService.scrollLeft&&b.cxScrollService.scrollLeft&&(a.scrollLeft=b.scrollLeft)}function i(){b.cancel(e),e=b(j,100)}function j(){}var k,l,m,n=[];this.addElement=c}var e,f={};this.bind=c}]),a.module("ng.cx.grid.grid",["ng.cx.grid.cxScroll","ng.cx.grid.CxGrid"]).directive("cxGrid",[function(){return{restrict:"AE",replace:"element",templateUrl:"src/grid/ng.cx.grid.html",controller:"cxGridController as gridController",scope:{},bindToController:{ioDataProvider:"=?",ioRowHeaderDataProvider:"=?",ioColumnHeaderDataProvider:"=?",ioCellRenderer:"@?",ioRowHeaderRenderer:"@?",ioColumnHeaderRenderer:"@?",ioCornerRenderer:"@?"}}}]).controller("cxGridController",["$scope","$timeout","$element","CxGrid",function(b,c,d,e){function f(b){return a.element(d[0].querySelector(b))}var g,h,i,j,k;h=f(".row-headers"),i=f(".column-headers"),j=f(".grid"),k=f(".corner"),g=new e(this.ioDataProvider,this.ioColumnHeaderDataProvider,this.ioRowHeaderDataProvider,this.ioCellRenderer,this.ioColumnHeaderRenderer,this.ioRowHeaderRenderer,this.ioCornerRenderer,d,i,h,j,k),window.cxGrid=g}]),a.module("ng.cx.grid",["ng.cx.grid.grid"]),a.module("ng.cx.grid").run(["$templateCache",function(a){a.put("src/grid/ng.cx.grid.html","<div class=ng-cx-grid><div class=header><div class=corner></div><div class=column-headers cx-scroll=gridScroll io-scroll-restrict-to-axis=x></div></div><div class=body><div class=row-headers cx-scroll=gridScroll io-scroll-restrict-to-axis=y></div><div class=grid cx-scroll=gridScroll></div></div></div>")}])}(angular);