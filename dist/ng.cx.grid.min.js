/**********************************************************
 * 
 * ng.cx.grid - v0.1.12
 * 
 * Release date : 2016-05-11 : 17:16
 * Author       : Jaime Beneytez - EF CTX 
 * License      : MIT 
 * 
 **********************************************************/



!function(a){"use strict";a.module("ng.cx.grid.CxCell",[]).factory("CxCell",["$compile","$rootScope","$timeout",function(a,b,c){function d(a,b,c){function d(){x=!0,v.addClass(y)}function f(){x=!1,v.removeClass(y)}function g(){return x=!x,x?d():f()}function h(){return w}function i(){return v}function l(){return r(v,"width")}function m(){return r(v,"height")}function n(){return r(v,"top")}function o(){return r(v,"left")}function p(){return s(v,"top")}function q(){return s(v,"left")}function r(a,b){return u||(u=j(a)),u[b]}function s(a,b){return t||(t=k(a)),t[b]}var t,u,v,w=a,x=!1,y="highlight";Object.defineProperty(this,"data",{get:h}),Object.defineProperty(this,"$element",{get:i}),Object.defineProperty(this,"width",{get:l}),Object.defineProperty(this,"height",{get:m}),Object.defineProperty(this,"relativeTop",{get:p}),Object.defineProperty(this,"relativeLeft",{get:q}),Object.defineProperty(this,"absoluteTop",{get:n}),Object.defineProperty(this,"absoluteLeft",{get:o}),this.toggleHighlight=g,this.highlight=d,this.unHighlight=f,v=e(a,b,c)}function e(a,b,c){var d,e;return e='<div class="cx-grid-cell"><div class="cx-grid-cell-renderer" ###directiveId###></div></div>',e=e.replace("###directiveId###",b),d=i(a,e),c&&f(d,c),d}function f(a,b){b.measure&&g(a,b.measure),b.position&&h(a,b.position)}function g(a,b){a.css("width",b.width+"px"),a.css("height",b.height+"px")}function h(a,b){a.css("transform","translate3d("+(b.x||0)+"px,"+(b.y||0)+"px, 0px )")}function i(c,d){var e=b.$new(!0);return e.dataProvider=c,a(d)(e)}function j(a){return a[0].getBoundingClientRect()}function k(a){var b,c=j(a),d=a.parent();return b=d?j(d):null,{left:c.left-(b?b.left:0),top:c.top-(b?b.top:0)}}return d}]),a.module("ng.cx.grid.CxGrid",["ng.cx.grid.CxCell"]).factory("CxGrid",["$timeout","CxCell",function(a,b){function c(b,c,g,h,i,j,k,l,m,n,o,p){function q(a,b){var c="x"===b?"y":"x";H[b]&&H[b].index!==a&&(void 0!==H.x&&H.x.unHighlight(),void 0!==H.y&&H.y.unHighlight()),H[c]&&H[c].unHighlight(),H[b]="x"===b?D(a):C(a),void 0!==H[b]&&H[b].toggleHighlight()}function r(a){q(a,"x")}function s(a){q(a,"y")}function t(){u(),w(),a(z),a(A),a(v)}function u(){l.css("opacity",0)}function v(){l.css("opacity",1)}function w(){F=c.map(x),E=g.map(y)}function x(a){var b=d(a,i);return m.append(b.$element),b}function y(a){var b=d(a,j);return n.append(b.$element),b}function z(){var a={measure:{width:e(E,"width"),height:e(F,"height")}},b=d(void 0,k,a);p.append(b.$element)}function A(){var a,b,c=F.length,d=E.length;for(a=0;d>a;a++)for(G[a]=[],b=0;c>b;b++)G[a][b]=B(a,b)}function B(a,c){var e,f=b[a][c],g=F[c],i=E[a],j={measure:{width:g.width,height:i.height},position:{x:g.relativeLeft,y:i.relativeTop}};return e=d(f,h,j),o.append(e.$element),e}function C(a){for(var b=[F[a]],c=0;c<G.length;c++)b.push(G[c][a]);return new f(a,b)}function D(a){return new f(a,[E[a]].concat(G[a]))}var E=[],F=[],G=[[]],H={x:void 0,y:void 0};this.highlightRow=r,this.highlightColumn=s,t()}function d(a,c,d){return new b(a,c,d)}function e(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)}function f(a,b){function c(){b.map(function(a){a.toggleHighlight()})}function d(){b.map(function(a){a.highlight()})}function e(){b.map(function(a){a.unHighlight()})}function f(a){return g.index===a.index}var g=this;Object.defineProperty(this,"index",{get:function(){return a}}),this.highlight=d,this.unHighlight=e,this.toggleHighlight=c,this.isEqual=f}return c}]),a.module("ng.cx.grid.cxScroll",[]).directive("cxScroll",[function(){return{restrict:"AE",bindToController:{ioScrollId:"@",ioScrollRestrictToAxis:"@?",ioSnapCoords:"=?",ioScrollOnScroll:"=?"},controller:"cxScrollController as cxScrollController"}}]).controller("cxScrollController",["$element","$attrs","cxScrollService",function(a,b,c){var d,e,f="x"===this.ioScrollRestrictToAxis,g="y"===this.ioScrollRestrictToAxis,h=this.ioSnapCoords,i=this.ioScrollOnScroll,j=b.cxBindScroll;f&&(d=!1,e=!0),g&&(d=!0,e=!1),c.bind(j,a,d,e,h,i)}]).service("cxScrollService",["$timeout",function(b){function c(a,b,c,d,f,h){g[a]||(g[a]=new e),g[a].addElement(b,c,d,f,h)}function d(a){return g[a]}function e(){function c(b,c,e,f,g){var h=b[0];k=b,h.cxScrollService={scrollTop:a.isDefined(c)?c:!0,scrollLeft:a.isDefined(e)?e:!0},f&&(m=f,l=h),g&&k.on("scroll",g),n.push(h),d()}function d(){k.on("scroll",e)}function e(a){i(),g(a.target)}function g(a){for(var b=0;b<n.length;b++)h(n[b],a)}function h(a,b){a.cxScrollService.scrollTop&&b.cxScrollService.scrollTop&&(a.scrollTop=b.scrollTop),a.cxScrollService.scrollLeft&&b.cxScrollService.scrollLeft&&(a.scrollLeft=b.scrollLeft)}function i(){b.cancel(f),f=b(j,100)}function j(){}var k,l,m,n=[];this.addElement=c,Object.defineProperty(this,"$element",{get:function(){return k}})}var f,g={};this.bind=c,this.getScrollBindingById=d}]),a.module("ng.cx.grid.grid",["ng.cx.grid.cxScroll","ng.cx.grid.CxGrid"]).directive("cxGrid",[function(){return{restrict:"AE",replace:"element",templateUrl:"src/grid/ng.cx.grid.html",controller:"cxGridController as gridController",scope:{},bindToController:{ioDataProvider:"=?",ioRowHeaderDataProvider:"=?",ioColumnHeaderDataProvider:"=?",ioCellRenderer:"@?",ioRowHeaderRenderer:"@?",ioColumnHeaderRenderer:"@?",ioCornerRenderer:"@?"}}}]).service("cxGridService",[function(){function a(a){e=a}function b(){e=void 0}function c(a){e.highlightRow(a)}function d(a){e.highlightColumn(a)}var e;this.addGrid=a,this.cleanCurrentGrid=b,this.highlightRow=c,this.highlightColumn=d}]).controller("cxGridController",["$scope","$timeout","$element","CxGrid","cxGridService",function(b,c,d,e,f){function g(a){var b=a.target.scrollTop,c=a.target.scrollLeft;b>0?n.addClass("is-scrolling-y"):n.removeClass("is-scrolling-y"),c>0?n.addClass("is-scrolling-x"):n.removeClass("is-scrolling-x")}function h(b){return a.element(d[0].querySelector(b))}var i,j,k,l,m,n=d;this.scrollHandler=g,j=h(".cx-grid-rh-container"),k=h(".cx-grid-ch-container"),l=h(".cx-grid-cells-container"),m=h(".cx-grid-corner-container"),i=new e(this.ioDataProvider,this.ioColumnHeaderDataProvider,this.ioRowHeaderDataProvider,this.ioCellRenderer,this.ioColumnHeaderRenderer,this.ioRowHeaderRenderer,this.ioCornerRenderer,d,k,j,l,m),f.addGrid(i)}]),a.module("ng.cx.grid",["ng.cx.grid.grid"]),a.module("ng.cx.grid").run(["$templateCache",function(a){a.put("src/grid/ng.cx.grid.html","<div class=ng-cx-grid><div class=cx-grid-header><div class=cx-grid-corner-container></div><div class=cx-grid-ch-container cx-scroll=gridScroll io-scroll-restrict-to-axis=x></div></div><div class=cx-grid-body><div class=cx-grid-rh-container cx-scroll=gridScroll io-scroll-restrict-to-axis=y></div><div class=cx-grid-cells-container cx-scroll=gridScroll io-scroll-on-scroll=gridController.scrollHandler></div></div></div>")}])}(angular);